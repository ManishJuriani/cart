create database cart;

use cart

create table states
(
state_id int not null primary key,
state varchar(30) not null
);

create table cities
(
city_id int not null primary key,
city varchar(30) not null,
state_id int not null,
constraint fk_states_cities foreign key (state_id) references states (state_id)
);

create table user_types
(
user_type_id int not null primary key,
user_type varchar(12) not null
);

create table status
(
status_id int not null primary key,
status varchar(12) not null
);

create table categories
(
category_id int not null primary key,
category varchar(30) not null
);

create table order_status
(
order_status_id int not null primary key,
order_status varchar(30) not null
);

create table users
(
user_id int not null primary key,
user_name varchar(30) not null,
email varchar(40) not null,
password varchar(100) not null,
dob date null,
gender varchar(7) null,
contact varchar(20) null,
address varchar(400) null,
city_id int null,
status_id int not null default 2,
user_type_id int not null default 1,
constraint fk_users_cities foreign key (city_id) references cities (city_id),
constraint fk_users_status foreign key (status_id) references status (status_id),
constraint fk_users_user_types foreign key (user_type_id) references user_types (user_type_id)
);

alter table users auto_increment = 1;

alter table cities auto_increment = 1;

alter table order_status auto_increment = 1;

alter table states auto_increment = 1;

alter table status auto_increment = 1;

alter table user_types auto_increment = 1;

alter table categories auto_increment = 1;

create table products
(
product_id int not null auto_increment primary key,
product_title varchar(40) not null,
user_id int not null,
launch_date timestamp not null,
quantity int not null,
mrp int not null,
discount int null default 0,
category_id int not null,
description varchar(5000) not null,
gst float not null default 0,
sold int not null default 0,
product_image_id int not null,
constraint fk_products_users foreign key (user_id) references users (user_id),
constraint fk_products_categories foreign key (category_id) references categories (category_id)
);

create table product_images
(
product_image_id int not null auto_increment primary key,
product_id int not null ,
image_path varchar(30) not null,
status_id int not null default 1,
constraint fk_product_images_products foreign key (product_id) references products (product_id),
constraint fk_product_images_status foreign key (status_id) references status (status_id)
);

alter table products 
add constraint fk_products_product_images foreign key (product_image_id) 
references product_images (product_image_id);

create table carts
(
cart_id int not null auto_increment primary key,
user_id int not null,
cart_time timestamp not null,
items_added int not null,
constraint fk_carts_users foreign key (user_id) references users (user_id)
);

create table cart_items
(
cart_item_id int not null auto_increment primary key,
cart_id int not null,
product_id int not null,
order_status_id int not null,
quantity int not null,
constraint fk_cart_items_carts foreign key (cart_id) references carts (cart_id),
constraint fk_cart_items_products foreign key (product_id) references products (product_id),
constraint fk_cart_items_order_status foreign key (order_status_id) references order_status (order_status_id)
);

alter table status
change column status_id status_id int not null auto_increment; 

alter table user_types 
change column user_type_id user_type_id int not null auto_increment;

alter table order_status
change column order_status_id order_status_id int not null auto_increment;

insert into status
(status)
values
('active'),('inactive'),('blocked'),('deleted');

insert into user_types
(user_type)
values
('Buyer'),('Seller'),('Admin');

insert into order_status
(order_status)
values
('Ordered'),('Packed'),('Shipped'),('Delivered');

alter table users
change column user_id user_id int not null auto_increment;